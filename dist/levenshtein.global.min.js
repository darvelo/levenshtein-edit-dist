"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),MATCH=0,INSERT=1,DELETE=2,Levenshtein=function(){function t(e){return _classCallCheck(this,t),e="object"==typeof e?e:{},this instanceof t?(this.caseSensitive=!!e.caseSensitive,this.m=[],void this.set("type",e.type)):new t(e)}return _createClass(t,[{key:"_initFirstRowWhole",value:function(){var t,e=this.m,i=e[0].length,s=this._s1,n=this._s2,r=null,o=s[1];for(t=0;i>t;++t)t>0?(e[0][t].cost=e[0][t-1].cost+this.insertCost(n[t],r,o),e[0][t].parent=INSERT):(e[0][t].cost=0,e[0][t].parent=-1)}},{key:"_initFirstRowSubstring",value:function(){var t,e=this.m,i=e[0].length;for(t=0;i>t;++t)e[0][t].cost=0,e[0][t].parent=-1}},{key:"_initFirstRow",value:function(){this.m.length&&("whole"===this.type?this._initFirstRowWhole():"substring"===this.type&&this._initFirstRowSubstring())}},{key:"_initFirstColumn",value:function(){var t,e=this.m,i=e.length,s=this._s1;for(t=0;i>t;++t)t>0?(e[t][0].cost=e[t-1][0].cost+this.deleteCost(s[t]),e[t][0].parent=DELETE):(e[t][0].cost=0,e[t][0].parent=-1)}},{key:"_embiggenMatrixSize",value:function(){var t,e,i=this.m,s=this._s1.length,n=this._s2.length;for(i.length<s&&(i.length=s),t=0;s>t;++t)for(Array.isArray(i[t])?e=i[t].length:(i[t]=[],e=0),i[t].length<n&&(i[t].length=n);n>e;++e)i[t][e]={};this._initFirstRow(),this._initFirstColumn()}},{key:"_prepString",value:function(t){return t=" "+t.slice(0,this.MAX_LEN),this.caseSensitive||(t=t.toLowerCase()),t}},{key:"_matchType",value:function(t,e){return t===e?"M":"S"}},{key:"_goalCellWhole",value:function(t,e){return{i:t.length-1,j:e.length-1}}},{key:"_goalCellSubstring",value:function(t,e){var i,s={},n=e.length,r=this.m,o=t.length-1,h=0;for(s.i=o,i=1;n>i;++i)r[o][i].cost<r[o][h].cost&&(h=i);return s.j=h,s}},{key:"_goalCell",value:function(){var t=this._s1,e=this._s2;return"whole"===this.type?this._goalCellWhole(t,e):"substring"===this.type?this._goalCellSubstring(t,e):void 0}},{key:"_levenshtein",value:function(){var t,e,i,s,n,r=[],o=this._s1,h=this._s2,l=this.m,u=o.length,a=h.length;for(t=1;u>t;++t)for(e=1;a>e;++e)for(s=o[t],n=t===u-1?null:o[t+1],r[MATCH]=l[t-1][e-1].cost+this.matchCost(o[t],h[e]),r[INSERT]=l[t][e-1].cost+this.insertCost(h[e],s,n),r[DELETE]=l[t-1][e].cost+this.deleteCost(o[t]),l[t][e].cost=r[MATCH],l[t][e].parent=MATCH,i=INSERT;DELETE>=i;++i)r[i]<l[t][e].cost&&(l[t][e].cost=r[i],l[t][e].parent=i)}},{key:"set",value:function(t,e){var i,s=this.type;this[t]=e,"type"===t?(i=["whole","substring"],-1===i.indexOf(e)&&(this.type="whole"),s!==this.type&&"substring"===this.type&&this._initFirstRow()):"matchCost"===t?"number"==typeof e&&(this[t]=function(t,i){return t===i?0:e}):"insertCost"===t?("number"==typeof e&&(this[t]=function(){return e}),"substring"!==this.type&&this._initFirstRow()):"deleteCost"===t&&("number"==typeof e&&(this[t]=function(){return e}),this._initFirstColumn())}},{key:"recursePath",value:function(t){function e(o,h){if(-1!==s[o][h].parent){var l,u={};return s[o][h].parent===MATCH?(e(o-1,h-1),l=i._matchType(n[o],r[h]),u.i=o-1,u.j=h-1,u.op=l,"M"===l?u.letter=r[h]:(u.from=n[o],u.to=r[h]),void t(u)):s[o][h].parent===INSERT?(e(o,h-1),u.i=o,u.j=h-1,u.op="I",u.letter=r[h],void t(u)):s[o][h].parent===DELETE?(e(o-1,h),u.i=o-1,u.op="D",u.letter=n[o],void t(u)):void 0}}if("function"==typeof t){var i=this,s=this.m,n=this._s1,r=this._s2,o=this._goalCell();e(o.i,o.j)}}},{key:"reconstructPath",value:function(){var t=[];return this.recursePath(function(e){return t.push(e)}),t}},{key:"totalCost",value:function(){var t,e=this;return 0===this.s1.length?this.s2.split("").reduce(function(t,i){return t+e.insertCost(i,null,null)},0):0===this.s2.length?this.s1.split("").reduce(function(t,i){return t+e.deleteCost(i)},0):(t=this._goalCell(),this.m[t.i][t.j].cost)}},{key:"matchCost",value:function(t,e){return t===e?0:1}},{key:"insertCost",value:function(t,e,i){return 1}},{key:"deleteCost",value:function(t){return 1}},{key:"process",value:function(t,e){return this._s1=this._prepString(t),this._s2=this._prepString(e),this.s1=this._s1.slice(1),this.s2=this._s2.slice(1),this._embiggenMatrixSize(),this._levenshtein(),this}}]),t}();